@model Rocky_Models.ViewModels.HomeVM

<div class="container">
    <div class="text-center">
        <button class="btn btn-dark filter-button" data-filter="all">All</button>
        @foreach (var obj in Model.Categories)
        {
            <button class="btn btn-outline-secondary filter-button" data-filter="@obj.Name.Replace(' ', '_')">
                @obj.Name
            </button>
        }
    </div>

    <br />

    <div class="search-container">
        <form id="search-form" asp-action="SearchEvents" method="post">
            <input type="text" placeholder="Describe the event you want to find" name="query" class="search-input">
            <button type="submit" class="search-button">
                <i class="fas fa-search"></i>
            </button>
        </form>
    </div>
    <br />

    <div id="loading" style="display:none; text-align:center;">
        <img src="~/images/loading1.gif" alt="Loading..." />
    </div>

    <div id="search-results">
        <div class="row">
            @foreach (var prod in Model.Products)
            {
                <partial name="_IndividualProductCard" model="prod" />
            }
        </div>
    </div>
</div>

@section Scripts
{
    <script>
        $(document).ready(function () {

            $(".filter-button").click(function () {
                var value = $(this).attr('data-filter');
                if (value == "all") {
                    $('.filter').show('1000');
                }
                else {
                    $(".filter").not('.' + value).hide('3000');
                    $('.filter').filter('.' + value).show('3000');
                }
            });

            $('#search-form').submit(function (event) {
                event.preventDefault();
                var form = $(this);
                var formData = form.serialize();

                $('#loading').show();
                $('#search-results').hide();

                $.ajax({
                    url: '@Url.Action("SearchEvents", "Home")', 
                    method: 'POST',
                    data: formData,
                    success: function (result) {
                        $('#loading').hide();
                        $('#search-results').html(result).show();

                    },
                    error: function (xhr, status, error) {
                        $('#loading').hide();
                        alert('An error occurred while processing your request. Please try again.');
                    }
                });
            });
        });
    </script>
}
